/*
 * sensord
 *
 * Copyright (c) 2016 Samsung Electronics Co., Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

#ifndef _K_MEANS_CLUSTERING_H_
#define _K_MEANS_CLUSTERING_H_

#define NCOUNT 10 // each gesture's accel data count : 10
#define MCOUNT 10 // all gesture's count : 10
#define KCOUNT 10 // clusters : 10

typedef struct accel_t {
	float x;
	float y;
	float z;
} accel_t;

typedef struct mydata_t {
	accel_t accel;
	int ci; // cluster_index
	float ed; // euclid_distance
} mydata_t;

static accel_t pre_accel[MCOUNT][MCOUNT] = {
{ // 1 : 10
{-1.164108, 7.643872, 0.604188}, {7.069595, 8.834301, -0.259621}, {5.647062, 8.043473, -1.317249}, {-2.474179, 8.262416, 0.574277}, {-3.421736, 8.587841, 0.671187},
{5.581259, 7.938189, -0.061017}, {9.767502, 9.393025, 0.080160}, {1.715654, 8.282756, 0.666401}, {-1.267000, 8.651250, 0.949951}, {-0.745364, 9.410972, 0.936790},
},
{// 2 : 10
{-5.453243, 7.904689, 0.921237}, {6.577869, 7.850852, -0.715454}, {9.742377, 8.766105, -0.263210}, {1.098306, 7.858029, 0.154337}, {-3.128615, 8.367701, -0.601795},
{0.746561, 6.179464, -0.535992}, {8.614161, 8.823533, 0.047856}, {7.701300, 9.040084, -0.531207}, {-0.357727, 8.098508, 0.597009}, {-0.977468, 8.700303, 1.269392},
},
{ // 3 : 10
{-5.614758, 7.998010, 0.750150}, {8.346166, 7.079165, -1.014557}, {10.950752, 8.142776, -1.178465}, {3.942175, 7.050452, -0.910469}, {-3.151347, 7.777870, -0.336192},
{-5.108676, 5.765506, -0.597009}, {9.828518, 8.189436, -0.425922}, {9.214760, 8.612966, -0.235693}, {-1.032503, 7.598408, -0.379262}, {-1.619941, 8.426324, 0.667597},
},
{ // 4 : 10
{-3.512664, 9.358330, 0.881755}, {3.109473, 6.077770, -0.556331}, {12.928421, 7.389036, -1.883151}, {4.427918, 6.616154, -1.057628}, {-3.834498, 7.769495, -0.506082},
{-3.878765, 5.020142, 0.917647}, {11.827723, 7.232306, -1.493121}, {9.016156, 6.856634, -0.398405}, {-1.653440, 7.653443, -0.056231}, {-0.891326, 9.035298, 1.538585},
},
{ // 5 : 10
{-5.462814, 4.914857, 2.292324}, {11.674581, 7.300501, -4.130012}, {9.611969, 6.905686, -1.069592}, {-2.845066, 7.434499, 0.046660}, {-5.636294, 7.865208, 0.811167},
{4.771288, 5.461617, 0.264407}, {11.679367, 7.270591, -1.033699}, {2.652444, 7.524230, -0.836291}, {-1.777867, 8.413164, 0.460618}, {-0.637687, 9.296116, 1.083949},
},
{ // 6 : 10
{-4.633701, 8.845069, 1.204786}, {4.761717, 3.312863, 0.726222}, {13.666606, 5.358726, -4.336991}, {6.853044, 5.657829, -1.200001}, {-1.624727, 7.562516, -1.148555},
{-3.381058, 8.537591, -0.117248}, {0.619741, 4.677968, 1.712065}, {10.289137, 7.160522, -1.805385}, {9.940981, 7.770691, -1.380659}, {-2.120041, 7.106683, -0.173480},
},
{ // 7 : 10
{-3.206382, 5.365904, 2.713461}, {12.531212, 7.290931, -4.139583}, {9.736395, 6.192625, -3.211168}, {-0.808774, 7.464411, -0.683151}, {-4.664808, 8.009974, 0.800399},
{2.933600, 5.127820, 1.479961}, {11.454442, 7.607979, -2.586641}, {8.033901, 7.038487, -2.163112}, {-1.362712, 7.686942, -0.355334}, {-1.306481, 8.691928, 1.781456},
},
{ // 8 : 10
{-4.364508, 8.151150, 0.957129}, {9.333204, 8.337790, -0.252443}, {8.890532, 7.695317, -0.419940}, {-4.460221, 7.549356, -0.738186}, {1.598405, 7.000203, -0.252443},
{8.522038, 9.017352, 1.345963}, {2.496910, 8.901299, -0.053839}, {-0.832702, 9.029316, 0.662812}, {-0.570688, 9.365508, 1.395016}, {-0.244068, 9.688539, 1.416551},
},
{ // 9 : 10
{-3.330809, 9.231510, 0.416351}, {2.441875, 6.911668, 1.537389}, {10.674382, 8.793623, -0.124427}, {1.942972, 8.121240, -1.634298}, {-4.279563, 7.716853, -0.013161},
{0.428315, 6.967900, 0.727418}, {8.734999, 9.418149, 0.037089}, {5.035695, 9.007781, -0.417548}, {-1.374677, 8.394022, 0.646062}, {-0.878166, 9.153743, 1.534996},
},
{ // 10 : 10
{-4.297509, 7.952546, 1.599602}, {8.151150, 7.657032, -1.635494}, {11.949757, 7.990831, -1.161715}, {-0.959522, 7.045666, -1.478764}, {-5.868397, 7.222735, 0.472582},
{2.853441, 5.587241, 1.356731}, {11.580065, 8.148758, -1.221536}, {5.676972, 8.106883, -0.625723}, {-1.654637, 8.191828, -0.252443}, {-0.537189, 9.095119, 0.970290},
},
};



class k_means_clustering {
public:
	k_means_clustering();
	~k_means_clustering();

	bool get_template_base(int *template_base, float template_distance_table[][KCOUNT]);
	bool get_template_compare(int *template_compare, accel_t *accel_array);

private:
	mydata_t m_data[MCOUNT][NCOUNT];
	mydata_t m_means[KCOUNT];
	mydata_t m_histogram[KCOUNT][NCOUNT];
	mydata_t m_template_base[NCOUNT];
	bool     m_completed;

	void fill_data(void);
	void print_data(void);
	void decide_initial_means(void);
	void clustering(void);
	void decide_new_means(void);
	bool is_completed(void);
	void compute_template_base(void);
};

#endif /* _K_MEANS_CLUSTERING_H_ */

