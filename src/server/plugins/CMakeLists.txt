cmake_minimum_required(VERSION 2.6)
project(sensord-plugins CXX)

INCLUDE(FindPkgConfig)
PKG_CHECK_MODULES(plugin_pkgs REQUIRED dlog libxml-2.0)

FOREACH(flag ${plugin_pkgs_LDFLAGS})
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${flag}")
ENDFOREACH(flag)

FOREACH(flag ${plugin_pkgs_CFLAGS})
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${flag}")
ENDFOREACH(flag)

SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")

include_directories(${CMAKE_CURRENT_SOURCE_DIR})
include_directories(${CMAKE_SOURCE_DIR}/src/server)
include_directories(${CMAKE_SOURCE_DIR}/src/shared)

IF("${ACCEL}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/accel)
list (APPEND PLUGIN_SRCS "accel/accel_sensor.cpp")
add_definitions(-DENABLE_ACCEL)
ENDIF()
IF("${GYRO}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/gyro)
list (APPEND PLUGIN_SRCS "gyro/gyro_sensor.cpp")
add_definitions(-DENABLE_GYRO)
ENDIF()
IF("${PROXI}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/proxi)
list (APPEND PLUGIN_SRCS "proxi/proxi_sensor.cpp")
add_definitions(-DENABLE_PROXI)
ENDIF()
IF("${LIGHT}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/light)
list (APPEND PLUGIN_SRCS "light/light_sensor.cpp")
add_definitions(-DENABLE_LIGHT)
ENDIF()
IF("${GEO}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/geo)
list (APPEND PLUGIN_SRCS "geo/geo_sensor.cpp")
add_definitions(-DENABLE_GEO)
ENDIF()
IF("${AUTO_ROTATION}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/auto_rotation)
list (APPEND PLUGIN_SRCS "auto_rotation/auto_rotation_alg.cpp")
list (APPEND PLUGIN_SRCS "auto_rotation/auto_rotation_alg_emul.cpp")
list (APPEND PLUGIN_SRCS "auto_rotation/auto_rotation_sensor.cpp")
add_definitions(-DENABLE_AUTO_ROTATION)
ENDIF()
IF("${PRESSURE}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/pressure)
list (APPEND PLUGIN_SRCS "pressure/pressure_sensor.cpp")
add_definitions(-DENABLE_PRESSURE)
ENDIF()
IF("${TEMPERATURE}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/temperature)
list (APPEND PLUGIN_SRCS "temperature/temperature_sensor.cpp")
add_definitions(-DENABLE_TEMPERATURE)
ENDIF()
IF("${ULTRAVIOLET}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/ultraviolet)
list (APPEND PLUGIN_SRCS "ultraviolet/ultraviolet_sensor.cpp")
add_definitions(-DENABLE_ULTRAVIOLET)
ENDIF()
IF("${BIO_LED_RED}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/bio_led_red)
list (APPEND PLUGIN_SRCS "bio_led_red/bio_led_red_sensor.cpp")
add_definitions(-DENABLE_BIO_LED_RED)
ENDIF()
IF("${ORIENTATION}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(ORIENTATION_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_ORIENTATION)
ENDIF()
IF("${RV}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(RV_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_RV)
ENDIF()
IF("${GEOMAGNETIC_RV}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(GEOMAGNETIC_RV_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_GEOMAGNETIC_RV)
ENDIF()
IF("${GAMING_RV}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(GAMING_RV_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_GAMING_RV)
ENDIF()
IF("${TILT}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(TILT_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_TILT)
ENDIF()
IF("${UNCAL_GYRO}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(UNCAL_GYRO_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_UNCAL_GYRO)
ENDIF()
IF("${GRAVITY}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(ORIENTATION_ENABLE "1")
set(GRAVITY_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_ORIENTATION)
add_definitions(-DENABLE_GRAVITY)
ENDIF()
IF("${LINEAR_ACCEL}" STREQUAL "ON")
set(SENSOR_FUSION_ENABLE "1")
set(ORIENTATION_ENABLE "1")
set(GRAVITY_ENABLE "1")
set(LINEAR_ACCEL_ENABLE "1")
add_definitions(-DENABLE_SENSOR_FUSION)
add_definitions(-DENABLE_ORIENTATION)
add_definitions(-DENABLE_GRAVITY)
add_definitions(-DENABLE_LINEAR_ACCEL)
ENDIF()
IF("${SENSOR_FUSION_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/sensor_fusion)
list (APPEND PLUGIN_SRCS "sensor_fusion/euler_angles.cpp")
list (APPEND PLUGIN_SRCS "sensor_fusion/matrix.cpp")
list (APPEND PLUGIN_SRCS "sensor_fusion/orientation_filter.cpp")
list (APPEND PLUGIN_SRCS "sensor_fusion/quaternion.cpp")
list (APPEND PLUGIN_SRCS "sensor_fusion/rotation_matrix.cpp")
list (APPEND PLUGIN_SRCS "sensor_fusion/sensor_data.cpp")
list (APPEND PLUGIN_SRCS "sensor_fusion/vector.cpp")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/fusion)
list (APPEND PLUGIN_SRCS "fusion/fusion_sensor.cpp")
ENDIF()
IF("${ORIENTATION_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/orientation)
list (APPEND PLUGIN_SRCS "orientation/orientation_sensor.cpp")
ENDIF()
IF("${GRAVITY_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/gravity)
list (APPEND PLUGIN_SRCS "gravity/gravity_sensor.cpp")
ENDIF()
IF("${LINEAR_ACCEL_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/linear_accel)
list (APPEND PLUGIN_SRCS "linear_accel/linear_accel_sensor.cpp")
ENDIF()
IF("${TILT_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/tilt)
list (APPEND PLUGIN_SRCS "tilt/tilt_sensor.cpp")
ENDIF()
IF("${UNCAL_GYRO_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/uncal_gyro)
list (APPEND PLUGIN_SRCS "uncal_gyro/uncal_gyro_sensor.cpp")
ENDIF()
IF("${RV_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/rotation_vector/rv)
list (APPEND PLUGIN_SRCS "rotation_vector/rv/rv_sensor.cpp")
ENDIF()
IF("${GEOMAGNETIC_RV_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/rotation_vector/geomagnetic_rv)
list (APPEND PLUGIN_SRCS "rotation_vector/geomagnetic_rv/geomagnetic_rv_sensor.cpp")
ENDIF()
IF("${GAMING_RV_ENABLE}" STREQUAL "1")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/rotation_vector/gaming_rv)
list (APPEND PLUGIN_SRCS "rotation_vector/gaming_rv/gaming_rv_sensor.cpp")
ENDIF()
IF("${RV_RAW}" STREQUAL "ON")
include_directories(${CMAKE_SOURCE_DIR}/src/server/plugins/rotation_vector/rv_raw)
list (APPEND PLUGIN_SRCS "rotation_vector/rv_raw/rv_raw_sensor.cpp")
ENDIF()

configure_file(sensor_module_create.cpp.in sensor_module_create.cpp)

add_library(${PROJECT_NAME} SHARED
	sensor_module_create.cpp
	${PLUGIN_SRCS}
	)

target_link_libraries(${PROJECT_NAME} ${plugin_pkgs_LDFLAGS} "-lrt -ldl -pthread")

install(TARGETS ${PROJECT_NAME} DESTINATION ${CMAKE_INSTALL_LIBDIR})